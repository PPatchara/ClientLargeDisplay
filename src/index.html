<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Honey Spot</title>

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/lightslider.css">
    <link rel="stylesheet" href="css/stylesheet.css">

</head>
<body>

    <div class="demo">
        <div class="item">
            <ul id="content-slider" class="content-slider">
                <li data-id="#001">
                    <img src="img/1.jpg">
                    <!-- <h3>1</h3> -->
                </li>
                <li data-id="#002">
                    <img src="img/2.jpg">
                    <!-- <h3>2</h3> -->
                </li>
                <li data-id="#003">
                    <img src="img/3.jpg">
                    <!-- <h3>3</h3> -->
                </li>
            </ul>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <p id="save">Save</p>
            <p id="share">Share</p>
            <p id="calendar">Add to calendar</p>
            <p id="feedback"></p>
        </div>
    </div>
    

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/lightslider.min.js"></script>
    <script src="js/main.js"></script>
    <script src="socket/socket.io.js"></script>

    <script>
        var socket = io('http://localhost:3000');
        var connected = false;

        var slider, currentId;
        var currentState = 1;
        var timer = 0;
        var loopState = 'enable';

        $(document).ready(function() {
            socket.on('gesture swipeleft', (data) => {
                log('Gesture', data.gesture);
                navigate(data);
                changeStateNext();
            });
            socket.on('gesture swiperight', (data) => {
                log('Gesture', data.gesture);
                navigate(data);
                changeStatePrev();
            });
            socket.on('gesture swipeup', (data) => {
                log('Gesture', data.gesture);
                navigate(data);
                jumpTo(getLastState());
            });
            socket.on('gesture swipedown', (data) => {
                log('Gesture', data.gesture);
                detailedMode(data);
            });
            socket.on('gesture doubletap', (data) => {
                log('Gesture', data.gesture);
                save(data);
            });

            function countDown(time) {
                resetTimer(timer);
                timer = setTimeout(enableAutoSlide, time);
            }

            function resetTimer() {
                clearTimeout(timer);
            }

            function disableAutoSlide() {
                slider.pause();
                loopState = 'disable';
                log('LoopState','disable');
            }

            function enableAutoSlide() {
                slider.play();
                loopState = 'enable';
                log('LoopState','enable');
            }

            function getCurrentSlide(element) { 
                var currentSlide = $(element).find('li.active');
                return currentSlide;
            }
            function getCurrentEvent(element) { 
                currentId = getCurrentSlide(element).data('id');
                return currentId;
            }

            function changeStateNext() {
                slider.goToNextSlide(); 
            }
            
            function changeStatePrev() {
                slider.goToPrevSlide(); 
            }

            function keepLastState() {
                currentState = slider.getCurrentSlideCount();
                log('KeepState', currentState);
            }

            function getLastState() {
                return currentState;
            }

            function jumpTo(currentState) {
                slider.goToSlide(currentState);
                console.log("JumpTo: " + currentState);
            }

            function navigate(){
                disableAutoSlide();
                countDown(5000);
            }

            function detailedMode(data){
                var message = { 
                    'uid': data.uid,
                    'currentId': currentId
                };
                keepLastState();
                countDown(2000);
                socket.emit('detailed mode', message);
            }

            function save(data){
                var message = { 
                    'uid': data.uid,
                    'currentId': currentId
                };
                socket.emit('saved', message);
            }

            slider = $('#content-slider').lightSlider({
                item:1,
                slideMargin:0,
                loop:true,
                speed:500,
                auto:true,
                pause:10000,
                controls:false,
                pager:false,
                onSliderLoad: function(element) {
                    currentId = getCurrentEvent(element);
                    log('CurrentId', currentId);

                    socket.emit('largescreen state', currentId, loopState);
                },
                onAfterSlide: function (element) {
                    currentId = getCurrentEvent(element);
                    log('CurrentId', currentId);
                    socket.emit('largescreen state', currentId, loopState);
                }
            });
        });
    </script>
</body>
</html>
